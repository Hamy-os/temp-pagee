(()=>{"use strict";var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),t=new Uint8Array(16);function n(){if(!e)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}const o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(e){return"string"==typeof e&&o.test(e)};for(var i=[],s=0;s<256;++s)i.push((s+256).toString(16).substr(1));const a=function(e,t,o){var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){o=o||0;for(var a=0;a<16;++a)t[o+a]=s[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!r(n))throw TypeError("Stringified UUID is invalid");return n}(s)},c=e=>({propertyID:e.propertyID,quarterdeckID:e.ID,organizationID:e.orgID,domain:window.location.hostname,pageUrl:`${window.location.hostname}${window.location.pathname}`});function u(e,t,n){if(0!==n)for(let o=0;o<t.length;o+=1){if(t[o]===e)return t[o];if(t[o]instanceof Object){const r=l(e,t[o],n-1);if(r)return r}else if(t[o]instanceof Array){const r=u(e,t[o],n-1);if(r)return r}}}function l(e,t,n){if(0===n)return;const o=Object.keys(t);for(let r=0;r<o.length;r+=1){if(o[r]===e)return t[o[r]];if(t[o[r]]instanceof Object){const i=l(e,t[o[r]],n-1);if(i)return i}else if(t[o[r]]instanceof Array){const i=u(e,t[o[r]],n-1);if(i)return i}}}const d=async(e,t={},n=3)=>{const o=new Headers([["Accept","application/json"],["Access-Control-Allow-Credentials","true"]]);try{const n=await fetch(e,{credentials:"include",headers:o,...t});return await(n.ok?n.json():void 0)}catch(o){return n>1?d(e,t,n-1):void 0}},m=(e,t)=>{const n=new Headers([["Accept","application/json"],["Access-Control-Allow-Credentials","true"],["Content-Type","application/x-www-form-urlencoded"]]);return fetch(e,{method:"POST",mode:"no-cors",credentials:"include",headers:n,body:t})},p=()=>document.cookie.split(";").reduce(((e,t)=>Object.assign(e,{[t.split("=")[0].trim()]:t.split("=")[1]})),{}),h=()=>a(),f=e=>Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&"),g=(e="")=>{try{return JSON.parse(e)}catch(e){return{}}},w=(e,t)=>{if("string"==typeof e&&0!==e.length)try{return e.split(".").reduce(((e,t)=>{if(t.indexOf("[")>=0){const n=t.slice(t.indexOf("[")+1,t.indexOf("]"));return e[parseInt(n,10)]}return e[t]}),t)}catch(e){return e instanceof TypeError?void 0:void console.warn(e)}},y="HABU_1P_ID",_="bowline",b="__Habu^bowline",I="ns",E="siteConfig",O="CLIENT_ID",A="HABU_1P_ID",T="5.0.0",C={adh_asics:"https://fulcrum-antenna.imhd.io/getuid/imhd/google-adh?account_id=asics_adh",amazon_us:"https://fulcrum-antenna.imhd.io/getuid/imhd/amazon-us",liveramp:"https://fulcrum-antenna.imhd.io/getuid/imhd/liveramp",throtle:"https://fulcrum-antenna.imhd.io/getuid/imhd/throttle"},v={INFO:"Info",WARN:"Warn",ERROR:"Error"},S=(e={})=>{let t;t=e instanceof Array?{msg:e.join("; "),pageUrl:`${window.location.hostname}${window.location.pathname}`,type:v.INFO}:"object"!=typeof e?{msg:e,pageUrl:`${window.location.hostname}${window.location.pathname}`,type:v.INFO}:e;const n=Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&");return m("https://fulcrum-antenna.imhd.io/collect/jserrors/2041517b-a8db-4bd8-902c-a5eea719db61/imhd",n)},R=(e=.1)=>Math.random()+e>1?S:()=>{},U=v;function D(e){const t=e||j()||h();((e,t)=>{const n=encodeURIComponent("HABU_1P_ID"),o=encodeURIComponent(t),r=new Date,i=r.getTime()+2592e7;r.setTime(i);const s=`expires=${r.toUTCString()};max-age=25920000`;document.cookie=`${n}=${o};${s};path='/';secure; samesite=none`})(0,t),sessionStorage.setItem(y,t),localStorage.setItem(y,t)}function j(){const e=p().HABU_1P_ID,t=sessionStorage.getItem(y),n=localStorage.getItem(y);return e||t||n||null}const N=function(e,t,n){if(!window.__Habu[e])return n;const o=window.__Habu[e].bowline.filter((e=>e===t||"object"==typeof e&&Object.keys(e).includes(t))).pop();return o?o[t]:n},$=function(e){const t=function(){const e=[],t=()=>{},n=["fill","pop","reverse","shift","sort","splice","unshift"];return Object.getOwnPropertyNames(Array.prototype).filter((e=>n.includes(e))).forEach((n=>{e[n]=t})),e}(),n=function(){const e=window.__Habu||g(localStorage.getItem(b));return e?e.version!==T||Date.now()-e.ts>1728e5?null:e:null}()||{};n[e]&&Array.isArray(n[e].bowline)&&t.push(...n[e].bowline),n.huid=n.huid||j(),n.ts=Date.now(),n.version=T,n.ns=e,n[e]={[I]:e,[_]:t},window.__Habu=n,localStorage.setItem(b,JSON.stringify(window.__Habu))},P=function(e){if(!e||!e.details)return;const t=e.details.bowline||{},n=w(t.match,window);if(!n)return;if(!(n instanceof Array||n instanceof Object))return;if(!Array.isArray(t.highlights))return void R(.05)({type:U.ERROR,msg:"Corrupt Configuration: "+t.highlights,action:"Bowline: Iterate through highlights",...c(e)});const o=[];return t.highlights.forEach((e=>{let t;if(e.match?t=localStorage.getItem(e.match)||p()[e.match]||w(e.match,n):Array.isArray(n)?t=u(e.key,n,3):n instanceof Object&&(t=l(e.key,n,3)),!t)return;const r=Array.isArray(t)?t.join(","):t;o.push({key:e.key,value:r,type:e.type})})),o},k=function(e,t){window.__Habu[e].bowline.push(t),localStorage.setItem(b,JSON.stringify(window.__Habu))},H=[{code:"identity_management"},{code:"targeted_advertising"},{code:"personalization_optimization"},{code:"segmentation"},{code:"modeling"},{code:"activation"},{code:"analytics_insights"},{code:"data_sales"}],B=e=>{const t=[];return j()&&t.push({type:A,userID:j()}),e&&(D(e),t.push({type:O,userID:e})),t},L={getConsent:([e,t,n,o])=>{const r=N(e,E);let i,s;o?(i=O,s=o):j()?(i=A,s=j()):n({success:!1,error:"Missing Identity",flags:H}),d(((e,t,n)=>`https://origin-gangway.habu.com/gangway/${e}/user-consent/type/${t}/user/${n}`)(r.orgID,i,s),{method:"GET"},1).then((e=>{const o=e&&e.processingActivitiesUserConsent;e&&o?o&&0!==o.length?t({success:!0,flags:o}):n({success:!1,error:"Consent not set",flags:H}):n({success:!1,error:"Internal Service Error: Gangway. Please contact us",flags:H})})).catch((e=>n({success:!1,flags:H,error:e})))},setConsent:([e,t,n,o,r])=>{if(!r)return n(new Error("Missing consent signals"));if(!Array.isArray(r))return n(new Error("Expected Array"));if(0===r.length)return n(new Error("Empty Array"));const i=N(e,E),s=c(i),a="boolean"==typeof r[0]?H.map((e=>({...e,allowed:r[0]}))):r,u={...s,identities:JSON.stringify(B(o)),consentJson:JSON.stringify(a)};return k(e,{CONSENT_FLAGS:u}),m("https://fulcrum-antenna.imhd.io/collect/consent/c2661ce9-a421-465e-8b08-4c3e223b8ce3/imhd",f(u)).then((()=>t({success:!0,flags:a}))).catch((e=>n({error:e,success:!1})))},portability:([e,t,n,o])=>{const r=h(),i=N(e,E),s={...c(i),identities:JSON.stringify(B(o)),requestID:r};m("https://fulcrum-antenna.imhd.io/collect/portability/203f3c3a-c0cf-4629-9f76-9b70093059de/imhd",f(s)).then((()=>t({success:!0,requestID:r}))).catch((e=>n({error:e,success:!1})))},rtbf:([e,t,n,o,r])=>{const i=h(),s=N(e,E),a={...c(s),identities:JSON.stringify(B(o)),requestID:i};r&&(a.email=r),m("https://fulcrum-antenna.imhd.io/collect/rtbf/7014021d-f07a-45d0-8bd8-c21d44eb291e/imhd",f(a)).then((()=>t({success:!0,requestID:i}))).catch((e=>n({error:e,success:!1})))}};async function x(e,t,n){const{orgID:o}=N(e,E,{});if(!o)return Promise.reject(new Error("Invalid Organization"));const r=localStorage.getItem(`${e}^__Habu_duct^${t}`),i=N(e,"duct^"+t);if(r)return Promise.resolve(g(r));if(i)return Promise.resolve(i);{const e=await d(((e,t,n)=>`https://nestorix.imhd.io/nestorix/organization/${e}/user-data/type/${t}/user/${n}`)(o,t,n),{},1);return e&&e.data?Promise.resolve(e.data):Promise.reject(new Error(e.error||"Unknown response"))}}function F([e,t,n]){const o=j(),r=A;return o?x(e,r,o).then((o=>{o?o.error?n({success:!1,error:o.error}):(k(e,{["duct^"+r]:o.data}),localStorage.setItem(`${e}^__Habu_duct^${r}`,JSON.stringify(o.data)),t({success:!0,data:o.data})):n({success:!1,error:"Unknown response"})})).catch((t=>{const o=N(e,E);R()({type:U.ERROR,msg:"API response error: "+t,action:"DataDuct: Fetch user data",...c(o)}),n({success:!1,error:t.message})})):n({success:!1,error:"Cannot resolve user id"})}const J={CAPTURE_CONSENT:"CAPTURE_CONSENT",GET_CONSENT:"GET_CONSENT",REQUEST_PORTABILITY:"REQUEST_PORTABILITY",REQUEST_RTBF:"REQUEST_RTBF",ENABLE_DUCT:"ENABLE_DUCT",LIST_ABILITIES:"LIST_ABILITIES"},z={CAPTURE_CONSENT:L.setConsent,GET_CONSENT:L.getConsent,REQUEST_PORTABILITY:L.portability,REQUEST_RTBF:L.rtbf,ENABLE_DUCT:F,LIST_ABILITIES:([,e])=>e(Object.values(J))},G=[],Q=e=>(t,...n)=>(e=>!!J[e])(t)?(G.push([t,n]),new Promise(((t,n)=>{setTimeout((()=>{((e,t,n)=>{const[o,r]=G.pop();z[o]([e,t,n,...r])})(e,t,n)}),1e3)}))):Promise.reject(new Error("Invalid Ask"));const M=async e=>{const t=N(e,E);let n=function(){const e=[void 0,null,""],t=new Date;let n={};if(window.location.ancestorOrigins&&window.location.ancestorOrigins.length>0)n={Url1:window.location.ancestorOrigins[0]};else{n={Url1:window.location.hostname,Url2:window.location.pathname,Url3:window.location.search};const e=["utm_source","utm_medium","utm_campaign"];window.location.search.substring(1).split("&").forEach((t=>{const[o,r]=t.split("=").map((e=>decodeURIComponent(e)));e.includes(o)&&(n[o]=r)}))}const o={...n,userAgent:window.navigator.userAgent,tod:t.getTime(),dow:t.getUTCDay()},r={};return Object.keys(o).forEach((t=>{-1===e.indexOf(o[t])&&(r[t]=o[t])})),r}();const o=j();var r;o&&(n[o]=o),function(e){const t=document.createDocumentFragment();e.reduce(((e,t)=>((e,t,n=document.createDocumentFragment())=>{const o=document.createElement(e);return t.forEach((e=>o.setAttribute(e.key,e.value))),n.appendChild(o),n})("img",[{key:"width",value:"1px"},{key:"height",value:"1px"},{key:"src",value:t}],e)),t),document.getElementsByTagName("head")[0].appendChild(t)}((r=t.details)&&Object.hasOwnProperty.call(r,"partners")?Object.keys(C).filter((e=>r.partners.includes(e))).map((e=>C[e])):[]);const i=await function(e){const t=new Promise((e=>e(void 0)));return e.details.bowline&&Array.isArray(e.details.bowline.highlights)?0===e.details.bowline.highlights.length?t:new Promise((t=>{let n,o=600;const r=setInterval((()=>{n=P(e),o-=1,n?(clearInterval(r),t(((e=[],t,n="value")=>Array.isArray(t)&&Array.isArray(e)?0===t.length?{}:e.map((e=>({[t.map((t=>{return o=e,(n=t).startsWith("$")?o[n.substring(1)]:n;var n,o})).join(".")]:e[n]}))).reduce(((e,t)=>({...e,...t})),{}):{})(n,["bowline","$type","$key"]))):0===o&&(R()({type:U.ERROR,msg:"Cannot find client DL: "+e.details.bowline.match,action:"Bowline: Locate client dl",...c(e)}),t())}),100)})):t}(t);return i&&(n={...n,...i}),async function(e,t){return d("https://fulcrum-antenna.imhd.io/collect/pageview/297c2761-8f57-4e48-9846-c406b915ce0b/imhd",{method:"POST",mode:"no-cors",credentials:"include",body:f({...e,...c(t)}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}(n,t)},V={"ID":"8416018b-1fcb-4c56-a99d-e18e13e35753","CreatedAt":"2021-02-12T18:51:32.117948Z","CreatedByUserID":"712da422-c774-4192-a71d-a2d7da509853","UpdatedAt":"2021-04-22T23:31:34.399469Z","UpdatedByUserID":"712da422-c774-4192-a71d-a2d7da509853","DeletedAt":null,"propertyID":"08ebc1ef-cb36-4d75-9dd3-bbd672bb4b19","orgID":"dcb23cff-c1dd-4d41-9b54-ddd56b1cd280","details":{"bowline":{"highlights":[{"key":"author","match":"dataLayer.[0].author","type":"pageAttribute"},{"key":"category","match":"dataLayer.[0].category","type":"pageAttribute"},{"key":"datePublished","match":"dataLayer.[0].datePublished","type":"pageAttribute"},{"key":"pageType","match":"dataLayer.[0].pageType","type":"pageAttribute"},{"key":"paywallState","match":"dataLayer.[0].paywallState","type":"pageAttribute"},{"key":"vertical","match":"dataLayer.[0].vertical","type":"pageAttribute"},{"key":"secondaryVerticals","match":"dataLayer.[0].secondaryVerticals","type":"pageAttribute"},{"key":"anonymous_id","match":"anonymous_id","type":"userIdentifier"},{"key":"permutive-id","match":"permutive-id","type":"userIdentifier"}],"match":"window"},"collectPageViews":"true","partners":["throtle"],"version":"steady"},"namespace":"8416018b-1fcb-4c56-a99d-e18e13e35753"};(()=>{if(!Object.hasOwnProperty.call(V,"details")||!Object.hasOwnProperty.call(V.details,"version"))return void R()({type:U.ERROR,msg:"Quarterdeck: Missing/Malformed config",action:"Habu.js: Load config",domain:window.location.hostname,pageUrl:`${window.location.hostname}${window.location.pathname}`,...V});const e=V.details,t=V.ID;var n;D(),$(t),k(t,{[E]:V}),n=t,window.__Habu&&window.__Habu[n]||$(n),window.__Habu[n].do=Q(n),window.__Habu.do=Q(window.__Habu.ns),((e,t)=>{e.collectPageViews&&setTimeout((()=>M(t)))})(e,t)})()})();